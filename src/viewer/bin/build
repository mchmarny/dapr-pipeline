#!/bin/bash

set -o errexit
set -o pipefail

RELEASE_VERSION="v0.3.1"

go mod tidy
go mod vendor

CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -a -tags netgo -ldflags \
'-w -extldflags "-static" -X main.AppVersion=${RELEASE_VERSION}' \
-mod vendor -o ../../bin/viewer

CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -tags netgo -ldflags \
'-w -extldflags "-static" -X main.AppVersion=${RELEASE_VERSION}' \
-mod vendor -o ../../bin/viewer-linux

CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -a -tags netgo -ldflags \
'-w -extldflags "-static" -X main.AppVersion=${RELEASE_VERSION}' \
-mod vendor -o ../../bin/viewer-windows

# copy all resources
yes | cp -Rf ./resource/static ./resource/template ../../resource/

